import{k as b,p as C,r as i,j as e,C as h,a as x,e as f,f as k,b as p,B as j,I as g,o as L,s as v}from"./index-DjQDvwSR.js";import{A as E,a as P}from"./alert-DPW0vZ1w.js";function q(){const c=b(),[l]=C(),[n,y]=i.useState(""),[d,w]=i.useState(""),[u,m]=i.useState(!1),[o,a]=i.useState("");i.useEffect(()=>{let s=l.get("token_hash"),r=l.get("type");if(!s){const t=new URLSearchParams(window.location.hash.substring(1));s=t.get("token_hash"),r=t.get("type")}if(!s||r!=="recovery"){a("Lien de réinitialisation invalide ou expiré");return}(async()=>{try{if(!s){a("Token de réinitialisation manquant");return}const{error:t}=await v.auth.verifyOtp({token_hash:s,type:"recovery"});if(t)throw t;console.log("Token vérifié avec succès")}catch(t){console.error("Erreur de vérification du token:",t),a("Lien de réinitialisation invalide ou expiré")}})()},[l,c]);const N=async s=>{if(s.preventDefault(),a(""),n!==d){a("Les mots de passe ne correspondent pas");return}if(n.length<6){a("Le mot de passe doit contenir au moins 6 caractères");return}m(!0);try{const{error:r}=await v.auth.updateUser({password:n});if(r)throw r;alert("Mot de passe mis à jour avec succès !"),c("/dashboard")}catch(r){console.error("Erreur:",r),a("Erreur lors de la mise à jour : "+r.message)}finally{m(!1)}};return o&&!n?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs(h,{className:"w-full max-w-md",children:[e.jsxs(x,{children:[e.jsx(f,{className:"text-2xl font-bold text-red-600",children:"Erreur"}),e.jsx(k,{className:"text-gray-600",children:o})]}),e.jsx(p,{children:e.jsx(j,{onClick:()=>c("/auth/forgot-password"),className:"w-full",children:"Demander un nouveau lien"})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs(h,{className:"w-full max-w-md",children:[e.jsx(x,{children:e.jsx(f,{className:"text-2xl font-bold text-gray-800",children:"Nouveau mot de passe"})}),e.jsx(p,{children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nouveau mot de passe"}),e.jsx(g,{type:"password",value:n,onChange:s=>y(s.target.value),required:!0,minLength:6})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Confirmer le mot de passe"}),e.jsx(g,{type:"password",value:d,onChange:s=>w(s.target.value),required:!0,minLength:6})]}),o&&e.jsx(E,{variant:"destructive",children:e.jsx(P,{children:o})}),e.jsx(j,{type:"submit",disabled:u,className:"w-full",children:u?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Mise à jour..."]}):"Mettre à jour le mot de passe"})]})})]})})}export{q as default};
