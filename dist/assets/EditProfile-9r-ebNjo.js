import{k as U,m as P,r as f,u as c,j as e,B as x,A as N,C as p,a as h,e as u,b as _,n,I as i,T as S,g as k}from"./index-DjQDvwSR.js";import{C as z,A as I,L as T}from"./LogoUploadSimple-BtFOY0ck.js";import{B as C}from"./avatar-f2MVXntd.js";import{U as D}from"./user-Drh04oF-.js";import{M as V}from"./map-pin-e2Mj8Zsh.js";const H=()=>{const t=U(),{user:l,profile:a,loading:b}=P(),[F,y]=f.useState(!0),[g,v]=f.useState(!1),[s,j]=f.useState({first_name:"",last_name:"",email:"",phone:"",phone_number:"",company:"",company_name:"",city:"",address:"",address_street:"",address_city:"",address_postal_code:"",address_country:"",birth_date:"",presentation:"",profile_picture:"",logo_url:"",avatar_url:""});f.useEffect(()=>{if(!(typeof l>"u")){if(l===null){c.error("Vous devez être connecté pour accéder à cette page"),t("/auth/login");return}a?(j({first_name:a.first_name||"",last_name:a.last_name||"",email:a.email||"",phone:a.phone||"",phone_number:a.phone_number||"",company:a.company||"",company_name:a.company_name||"",city:a.city||"",address:a.address||"",address_street:a.address_street||"",address_city:a.address_city||"",address_postal_code:a.address_postal_code||"",address_country:a.address_country||"",birth_date:a.birth_date?a.birth_date.split("T")[0]:"",presentation:a.presentation||"",profile_picture:a.profile_picture||"",logo_url:a.logo_url||"",avatar_url:a.avatar_url||""}),y(!1)):(c.error("Erreur lors du chargement du profil"),y(!1))}},[t,l,a]);const A=async o=>{o.preventDefault(),v(!0);try{if(!l){c.error("Vous devez être connecté pour modifier votre profil");return}const d={first_name:s.first_name,last_name:s.last_name,email:s.email,phone:s.phone,phone_number:s.phone_number,company:s.company,company_name:s.company_name,city:s.city,address:s.address,address_street:s.address_street,address_city:s.address_city,address_postal_code:s.address_postal_code,address_country:s.address_country,birth_date:s.birth_date||null,presentation:s.presentation,profile_picture:s.profile_picture,logo_url:s.logo_url,avatar_url:s.avatar_url},m=await k.put(`/users/${l.id}`,d);if(!m.success){if(m.error==="Token invalide"||m.error==="Accès non autorisé"){c.error("Session expirée. Veuillez vous reconnecter."),t("/auth/login");return}c.error(`Erreur lors de la mise à jour du profil: ${m.error}`);return}c.success("Profil mis à jour avec succès"),t("/profile")}catch(d){console.error("Error updating profile:",d),c.error("Erreur lors de la mise à jour du profil")}finally{v(!1)}},r=o=>{const{name:d,value:m}=o.target;j(L=>({...L,[d]:m}))},E=async o=>{j(d=>({...d,avatar_url:o}))},w=async o=>{j(d=>({...d,logo_url:o}))};return b&&!a||F&&!s.first_name||typeof l>"u"?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>t("/profile"),className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),"Retour au profil"]})}),e.jsx(p,{children:e.jsx(h,{children:e.jsx(u,{children:"Chargement..."})})})]}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>t("/profile"),className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),"Retour au profil"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Modifier le profil"})]}),e.jsx(x,{variant:"outline",onClick:()=>t("/profile"),children:"Annuler"})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Photo de profil"]})}),e.jsx(_,{children:l&&e.jsx(I,{currentAvatarUrl:s.avatar_url,userId:l.id,onAvatarUpdated:E})})]}),e.jsxs(p,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Logo d'entreprise"]})}),e.jsx(_,{children:l&&e.jsx(T,{currentLogoUrl:s.logo_url,userId:l.id,onLogoUpdated:w})})]})]}),e.jsxs(p,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Informations personnelles"]})}),e.jsx(_,{children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"first_name",children:"Prénom"}),e.jsx(i,{id:"first_name",name:"first_name",value:s.first_name,onChange:r,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"last_name",children:"Nom"}),e.jsx(i,{id:"last_name",name:"last_name",value:s.last_name,onChange:r,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"Email"}),e.jsx(i,{id:"email",name:"email",type:"email",value:s.email,onChange:r,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"birth_date",children:"Date de naissance"}),e.jsx(i,{id:"birth_date",name:"birth_date",type:"date",value:s.birth_date,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phone",children:"Téléphone"}),e.jsx(i,{id:"phone",name:"phone",value:s.phone,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phone_number",children:"Numéro de téléphone"}),e.jsx(i,{id:"phone_number",name:"phone_number",value:s.phone_number,onChange:r})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"presentation",children:"Présentation"}),e.jsx(S,{id:"presentation",name:"presentation",value:s.presentation,onChange:r,rows:4,placeholder:"Parlez-nous de vous..."})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>t("/profile"),children:"Annuler"}),e.jsx(x,{type:"submit",disabled:g,children:g?"Enregistrement...":"Enregistrer"})]})]})})]}),e.jsxs(p,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Informations professionnelles"]})}),e.jsx(_,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"company",children:"Entreprise"}),e.jsx(i,{id:"company",name:"company",value:s.company,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"company_name",children:"Nom de l'entreprise"}),e.jsx(i,{id:"company_name",name:"company_name",value:s.company_name,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"city",children:"Ville"}),e.jsx(i,{id:"city",name:"city",value:s.city,onChange:r})]})]})})]}),e.jsxs(p,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Adresse"]})}),e.jsx(_,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"address",children:"Adresse complète"}),e.jsx(i,{id:"address",name:"address",value:s.address,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"address_street",children:"Rue"}),e.jsx(i,{id:"address_street",name:"address_street",value:s.address_street,onChange:r})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"address_city",children:"Ville"}),e.jsx(i,{id:"address_city",name:"address_city",value:s.address_city,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"address_postal_code",children:"Code postal"}),e.jsx(i,{id:"address_postal_code",name:"address_postal_code",value:s.address_postal_code,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"address_country",children:"Pays"}),e.jsx(i,{id:"address_country",name:"address_country",value:s.address_country,onChange:r})]})]})]})})]})]})]})};export{H as default};
