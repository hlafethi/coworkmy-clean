import{r as m,m as v,j as e,B as d,o as u,C,a as g,e as N,f as w,b,x as A,u as n}from"./index-DjQDvwSR.js";import{c as E}from"./stripeUtils-Dyfdw-WJ.js";import{C as i,E as p}from"./external-link-SKxx8wfR.js";import{A as S}from"./alert-circle-CLcitMK4.js";const B=({className:o="",variant:x="default"})=>{const[t,l]=m.useState(!1),[z,h]=m.useState(null),{user:s,isAdmin:j}=v(),c=async()=>{if(!(s!=null&&s.email)){n.error("Email utilisateur non disponible");return}try{l(!0);const r=`${window.location.origin}/dashboard`,{url:a,mode:f}=await E(s.email,r,j);console.log(`[Stripe] Portail client ouvert en mode ${f}: ${a}`),window.open(a,"_blank","noopener,noreferrer"),n.success("Portail client Stripe ouvert")}catch(r){console.error("[Stripe] Erreur lors de l'ouverture du portail client:",r);const a=r instanceof Error?r.message:"Erreur inconnue";a.includes("Aucun client Stripe trouvé")?(h(!1),n.error("Aucun compte de paiement trouvé. Effectuez d'abord une réservation pour créer votre compte client.")):n.error(`Erreur lors de l'ouverture du portail: ${a}`)}finally{l(!1)}};return x==="compact"?e.jsxs(d,{onClick:c,disabled:t||!(s!=null&&s.email),variant:"outline",size:"sm",className:`flex items-center gap-2 ${o}`,children:[t?e.jsx(u,{className:"h-4 w-4 animate-spin"}):e.jsx(i,{className:"h-4 w-4"}),"Factures & Abonnements",e.jsx(p,{className:"h-3 w-3"})]}):e.jsxs(C,{className:o,children:[e.jsxs(g,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(i,{className:"h-5 w-5"}),"Gestion des paiements"]}),e.jsx(w,{children:"Accédez à vos factures, abonnements et informations de paiement"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Portail client Stripe"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gérez vos paiements en toute sécurité"})]}),e.jsx(A,{variant:"secondary",children:"Sécurisé"})]}),e.jsx(d,{onClick:c,disabled:t||!(s!=null&&s.email),className:"w-full",size:"lg",children:t?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Ouverture..."]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"mr-2 h-4 w-4"}),"Accéder au portail client",e.jsx(p,{className:"ml-2 h-4 w-4"})]})}),!(s!=null&&s.email)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600 bg-amber-50 p-3 rounded-md",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{children:"Email utilisateur requis pour accéder au portail"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{children:"• Consultez l'historique de vos paiements"}),e.jsx("p",{children:"• Téléchargez vos factures"}),e.jsx("p",{children:"• Gérez vos méthodes de paiement"}),e.jsx("p",{children:"• Annulez ou modifiez vos abonnements"})]})]})]})};export{B as S};
