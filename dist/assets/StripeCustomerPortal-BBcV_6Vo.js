import{r as m,l as j,j as e,B as d,n as u,C as v,a as C,e as w,f as N,b as g,v as b,u as i}from"./index-BcTi7cvQ.js";import{c as A}from"./stripeUtils-B2dTlB1i.js";import{C as n,E as p}from"./external-link-4ui73uDh.js";import{A as E}from"./alert-circle-LFY28DfC.js";const B=({className:o="",variant:x="default"})=>{const[a,l]=m.useState(!1),[S,h]=m.useState(null),{user:s,isAdmin:f}=j(),c=async()=>{if(!(s!=null&&s.email)){i.error("Email utilisateur non disponible");return}try{l(!0);const r=`${window.location.origin}/profile`,{url:t,mode:z}=await A(s.email,r,f);if(!t)throw new Error("URL du portail Stripe non fournie");window.location.href=t,i.success("Portail client Stripe ouvert")}catch(r){console.error("[Stripe] Erreur lors de l'ouverture du portail client:",r);const t=r instanceof Error?r.message:"Erreur inconnue";t.includes("Aucun client Stripe trouvé")?(h(!1),i.error("Aucun compte de paiement trouvé. Effectuez d'abord une réservation pour créer votre compte client.")):i.error(`Erreur lors de l'ouverture du portail: ${t}`)}finally{l(!1)}};return x==="compact"?e.jsxs(d,{onClick:c,disabled:a||!(s!=null&&s.email),variant:"outline",size:"sm",className:`flex items-center gap-2 ${o}`,children:[a?e.jsx(u,{className:"h-4 w-4 animate-spin"}):e.jsx(n,{className:"h-4 w-4"}),"Factures & Abonnements",e.jsx(p,{className:"h-3 w-3"})]}):e.jsxs(v,{className:o,children:[e.jsxs(C,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(n,{className:"h-5 w-5"}),"Gestion des paiements"]}),e.jsx(N,{children:"Accédez à vos factures, abonnements et informations de paiement"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Portail client Stripe"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gérez vos paiements en toute sécurité"})]}),e.jsx(b,{variant:"secondary",children:"Sécurisé"})]}),e.jsx(d,{onClick:c,disabled:a||!(s!=null&&s.email),className:"w-full",size:"lg",children:a?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Ouverture..."]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{className:"mr-2 h-4 w-4"}),"Accéder au portail client",e.jsx(p,{className:"ml-2 h-4 w-4"})]})}),!(s!=null&&s.email)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600 bg-amber-50 p-3 rounded-md",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Email utilisateur requis pour accéder au portail"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{children:"• Consultez l'historique de vos paiements"}),e.jsx("p",{children:"• Téléchargez vos factures"}),e.jsx("p",{children:"• Gérez vos méthodes de paiement"}),e.jsx("p",{children:"• Annulez ou modifiez vos abonnements"})]})]})]})};export{B as S};
