<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cookies</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { margin: 5px; padding: 10px; }
        .status { margin: 10px 0; padding: 10px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Test du système de cookies</h1>
    
    <div class="test-section">
        <h3>État actuel</h3>
        <div id="status" class="status">Chargement...</div>
    </div>
    
    <div class="test-section">
        <h3>Actions</h3>
        <button onclick="resetCookies()">Réinitialiser les cookies</button>
        <button onclick="acceptAll()">Accepter tous</button>
        <button onclick="declineAll()">Refuser tous</button>
        <button onclick="updateStatus()">Actualiser l'état</button>
    </div>
    
    <div class="test-section">
        <h3>Préférences</h3>
        <label>
            <input type="checkbox" id="analytics" onchange="updatePreferences()"> Analytics
        </label>
        <label>
            <input type="checkbox" id="marketing" onchange="updatePreferences()"> Marketing
        </label>
        <button onclick="savePreferences()">Sauvegarder les préférences</button>
    </div>

    <script>
        const COOKIE_CONSENT_KEY = 'cookie-consent';
        const COOKIE_PREFERENCES_KEY = 'cookie-preferences';
        
        function updateStatus() {
            const consent = localStorage.getItem(COOKIE_CONSENT_KEY);
            const preferences = localStorage.getItem(COOKIE_PREFERENCES_KEY);
            
            let status = `Consentement: ${consent || 'Non défini'}<br>`;
            status += `Préférences: ${preferences || 'Non définies'}<br>`;
            
            if (preferences) {
                const prefs = JSON.parse(preferences);
                status += `Détails: Analytics=${prefs.analytics}, Marketing=${prefs.marketing}`;
            }
            
            document.getElementById('status').innerHTML = status;
        }
        
        function resetCookies() {
            localStorage.removeItem(COOKIE_CONSENT_KEY);
            localStorage.removeItem(COOKIE_PREFERENCES_KEY);
            updateStatus();
            console.log('Cookies réinitialisés');
        }
        
        function acceptAll() {
            localStorage.setItem(COOKIE_CONSENT_KEY, 'true');
            localStorage.setItem(COOKIE_PREFERENCES_KEY, JSON.stringify({
                necessary: true,
                analytics: true,
                marketing: true
            }));
            updateStatus();
            console.log('Tous les cookies acceptés');
        }
        
        function declineAll() {
            localStorage.setItem(COOKIE_CONSENT_KEY, 'false');
            localStorage.setItem(COOKIE_PREFERENCES_KEY, JSON.stringify({
                necessary: true,
                analytics: false,
                marketing: false
            }));
            updateStatus();
            console.log('Cookies refusés');
        }
        
        function updatePreferences() {
            const analytics = document.getElementById('analytics').checked;
            const marketing = document.getElementById('marketing').checked;
            
            const preferences = {
                necessary: true,
                analytics: analytics,
                marketing: marketing
            };
            
            localStorage.setItem(COOKIE_PREFERENCES_KEY, JSON.stringify(preferences));
            updateStatus();
        }
        
        function savePreferences() {
            updatePreferences();
            console.log('Préférences sauvegardées');
        }
        
        // Initialiser l'état
        updateStatus();
        
        // Charger les préférences actuelles
        const preferences = localStorage.getItem(COOKIE_PREFERENCES_KEY);
        if (preferences) {
            const prefs = JSON.parse(preferences);
            document.getElementById('analytics').checked = prefs.analytics;
            document.getElementById('marketing').checked = prefs.marketing;
        }
    </script>
</body>
</html>
