import{r as o,g as i,u as d}from"./index-v-g3ODAu.js";function z(){const[S,l]=o.useState([]),[I,g]=o.useState(!0),[h,p]=o.useState(!1),[y,w]=o.useState(null),s=o.useRef({}),c=o.useRef({}),f=async()=>{try{g(!0);const e=await i.get("/legal-pages"),t=e.success?e.data:null,r=e.success?null:{message:e.error};if(r){if(console.error("‚ùå Erreur SQL:",r),r.code==="42P01"){console.log("üìù Table legal_pages inexistante, utilisation des donn√©es par d√©faut"),await v();return}throw r}const a=Array.isArray(t)?t:[];if(a.length===0){console.log("üìù Aucune page trouv√©e, cr√©ation des pages par d√©faut"),await v();return}l(a),a.forEach(n=>{n.type&&["terms","privacy","legal"].includes(n.type)&&(s.current[n.type]=n)})}catch(e){console.error("‚ùå Erreur lors du chargement des pages l√©gales:",e),l(P()),d.error("Impossible de r√©cup√©rer les pages l√©gales - utilisation des donn√©es par d√©faut")}finally{g(!1)}},D=o.useCallback(async e=>{if(s.current[e])return console.log(`‚úÖ Page ${e} trouv√©e dans le cache`),s.current[e];if(c.current[e])return console.log(`‚è≥ Chargement de ${e} d√©j√† en cours, attente...`),new Promise(t=>{const r=setInterval(()=>{!c.current[e]&&s.current[e]&&(clearInterval(r),t(s.current[e]))},100);setTimeout(()=>{clearInterval(r),t(u(e))},5e3)});try{c.current[e]=!0,console.log(`üîç Recherche de la page ${e}...`);const t=await i.get("/legal-pages"),a=(t.success&&Array.isArray(t.data)?t.data:[]).find(n=>n.type===e);if(!a){console.log(`üìù Page ${e} non trouv√©e, cr√©ation...`);const n=u(e);return s.current[e]=n,n}return console.log(`‚úÖ Page ${e} trouv√©e`),s.current[e]=a,a}catch(t){console.error(`‚ùå Erreur lors du chargement de la page ${e}:`,t);const r=u(e);return s.current[e]=r,r}finally{c.current[e]=!1}},[]),E=async e=>{try{p(!0),console.log("üíæ Sauvegarde de la page:",e.type);const t={title:e.title,content:e.content,last_updated:new Date().toISOString()},r=await i.put(`/legal-pages/${e.type}`,t);if(!r.success)throw new Error(r.error||"Erreur lors de la mise √† jour");console.log("‚úÖ Page sauvegard√©e avec succ√®s");const a={...e,last_updated:t.last_updated};return l(n=>n.map(m=>m.type===e.type?a:m)),s.current[e.type]=a,d.success("Page mise √† jour avec succ√®s"),!0}catch(t){return console.error("‚ùå Erreur lors de la mise √† jour:",t),d.error("Impossible de mettre √† jour la page"),!1}finally{p(!1)}},C=o.useCallback(()=>{s.current={},c.current={}},[]),v=async()=>{try{const e=[{type:"terms",title:"Conditions G√©n√©rales d'Utilisation",content:"<p>Ins√©rez vos conditions g√©n√©rales ici.</p>",last_updated:new Date().toISOString()},{type:"privacy",title:"Politique de Confidentialit√©",content:"<p>Ins√©rez votre politique de confidentialit√© ici.</p>",last_updated:new Date().toISOString()},{type:"legal",title:"Mentions L√©gales",content:"<p>Ins√©rez vos mentions l√©gales ici.</p>",last_updated:new Date().toISOString()}],t=await i.post("/legal-pages",e);if(!t.success)throw new Error(t.error||"Erreur lors de la cr√©ation");console.log("‚úÖ Pages par d√©faut cr√©√©es");const r=Array.isArray(t.data)?t.data:[];l(r),r.forEach(a=>{a.type&&["terms","privacy","legal"].includes(a.type)&&(s.current[a.type]=a)})}catch(e){console.error("‚ùå Erreur cr√©ation pages par d√©faut:",e);const t=P();l(t),t.forEach(r=>{s.current[r.type]=r})}},P=()=>[{id:"1",type:"terms",title:"Conditions G√©n√©rales d'Utilisation",content:"<p>Ins√©rez vos conditions g√©n√©rales ici.</p>",last_updated:new Date().toISOString()},{id:"2",type:"privacy",title:"Politique de Confidentialit√©",content:"<p>Ins√©rez votre politique de confidentialit√© ici.</p>",last_updated:new Date().toISOString()},{id:"3",type:"legal",title:"Mentions L√©gales",content:"<p>Ins√©rez vos mentions l√©gales ici.</p>",last_updated:new Date().toISOString()}],u=e=>{const t={terms:"<p>Ins√©rez vos conditions g√©n√©rales ici.</p>",privacy:"<p>Ins√©rez votre politique de confidentialit√© ici.</p>",legal:"<p>Ins√©rez vos mentions l√©gales ici.</p>"};return{id:e,type:e,title:{terms:"Conditions G√©n√©rales d'Utilisation",privacy:"Politique de Confidentialit√©",legal:"Mentions L√©gales"}[e],content:t[e],last_updated:new Date().toISOString()}};return o.useEffect(()=>{f()},[]),{pages:S,loading:I,saving:h,selectedPage:y,setSelectedPage:w,fetchPages:f,fetchPageByType:D,updatePage:E,clearCache:C}}export{z as u};
