import{c as L,r as f,j as e,n as j,B as y,g as v,u as t}from"./index-BROMX9M_.js";import{A as $,a as C,b as _,B as k}from"./avatar-BoddfnNM.js";const P=L("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),z=["image/jpeg","image/jpg","image/png","image/webp"],G=({currentAvatarUrl:d,userId:p,onAvatarUpdated:o,className:E=""})=>{const[l,n]=f.useState(!1),[m,u]=f.useState(null),w=r=>{if(!z.includes(r.type))return t.error("Type de fichier non supportÃ©. Utilisez JPG, PNG ou WebP."),!1;const i=5*1024*1024;return r.size>i?(t.error("L'image ne doit pas dÃ©passer 5MB"),!1):!0},N=async r=>{var x;const i=(x=r.target.files)==null?void 0:x[0];if(i&&w(i)){n(!0);try{const s=new FileReader;s.onload=async S=>{var g;const c=(g=S.target)==null?void 0:g.result;if(c){u(c),o(c);try{const a=await v.put(`/users/${p}`,{avatar_url:c,updated_at:new Date().toISOString()});if(console.log("RÃ©sultat update:",a),!a.success)throw new Error(a.error||"Erreur lors de la mise Ã  jour");o(c),t.success("Photo de profil mise Ã  jour")}catch(a){console.error("Erreur technique :",a),t.error(`Erreur technique : ${(a==null?void 0:a.message)||"Erreur inconnue"}`),m&&u(null)}finally{n(!1)}}},s.onerror=()=>{t.error("Erreur lors de la lecture du fichier"),n(!1)},s.readAsDataURL(i)}catch(s){console.error("Erreur technique :",s),t.error(`Erreur technique : ${(s==null?void 0:s.message)||"Erreur inconnue"}`),n(!1)}}},b=async()=>{n(!0);try{const r=await v.put(`/users/${p}`,{avatar_url:null,updated_at:new Date().toISOString()});if(!r.success)throw new Error(r.error||"Erreur lors de la suppression");o(""),u(null),t.success("Photo de profil supprimÃ©e")}catch(r){console.error("Erreur suppression :",r),t.error(`Erreur : ${(r==null?void 0:r.message)||"Erreur inconnue"}`)}finally{n(!1)}},h=m||d;return e.jsxs("div",{className:`flex flex-col items-center space-y-4 ${E}`,children:[e.jsxs("div",{className:"relative",children:[e.jsxs($,{className:"w-24 h-24",children:[e.jsx(C,{src:h||void 0,alt:"Avatar",className:"object-cover"}),e.jsx(_,{className:"text-lg",children:d?"ðŸ‘¤":"ðŸ“·"})]}),l&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:e.jsx(j,{className:"h-6 w-6 animate-spin text-white"})})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(y,{type:"button",variant:"outline",size:"sm",disabled:l,className:"flex items-center space-x-2",onClick:()=>{var r;return(r=document.getElementById("avatar-upload"))==null?void 0:r.click()},children:[l?e.jsx(j,{className:"h-4 w-4 animate-spin"}):e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:l?"Upload...":"Changer"})]}),e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:N,className:"hidden",disabled:l}),d&&e.jsx(y,{type:"button",variant:"outline",size:"sm",onClick:b,disabled:l,className:"text-red-600 hover:text-red-700",children:"Supprimer"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"JPG, PNG, WebP â€¢ Max 5MB"})]})]})},M=["image/jpeg","image/jpg","image/png","image/webp","image/svg+xml"],q=({currentLogoUrl:d,userId:p,onLogoUpdated:o,className:E=""})=>{const[l,n]=f.useState(!1),[m,u]=f.useState(null),w=r=>{if(!M.includes(r.type))return t.error("Type de fichier non supportÃ©. Utilisez JPG, PNG, WebP ou SVG."),!1;const i=5*1024*1024;return r.size>i?(t.error("Le logo ne doit pas dÃ©passer 5MB"),!1):!0},N=async r=>{var x;const i=(x=r.target.files)==null?void 0:x[0];if(i&&w(i)){n(!0);try{const s=new FileReader;s.onload=async S=>{var g;const c=(g=S.target)==null?void 0:g.result;if(c){u(c),o(c);try{const a=await v.put(`/users/${p}`,{logo_url:c,updated_at:new Date().toISOString()});if(console.log("RÃ©sultat update logo:",a),!a.success)throw new Error(a.error||"Erreur lors de la mise Ã  jour");o(c),t.success("Logo mis Ã  jour")}catch(a){console.error("Erreur technique logo :",a),t.error(`Erreur technique : ${(a==null?void 0:a.message)||"Erreur inconnue"}`),m&&u(null)}finally{n(!1)}}},s.onerror=()=>{t.error("Erreur lors de la lecture du fichier"),n(!1)},s.readAsDataURL(i)}catch(s){console.error("Erreur technique logo :",s),t.error(`Erreur technique : ${(s==null?void 0:s.message)||"Erreur inconnue"}`),n(!1)}}},b=async()=>{n(!0);try{const r=await v.put(`/users/${p}`,{logo_url:null,updated_at:new Date().toISOString()});if(!r.success)throw new Error(r.error||"Erreur lors de la suppression");o(""),u(null),t.success("Logo supprimÃ©")}catch(r){console.error("Erreur suppression logo :",r),t.error(`Erreur : ${(r==null?void 0:r.message)||"Erreur inconnue"}`)}finally{n(!1)}},h=m||d;return e.jsxs("div",{className:`flex flex-col items-center space-y-4 ${E}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50",children:h?e.jsx("img",{src:h,alt:"Logo",className:"w-full h-full object-contain rounded-lg"}):e.jsx(k,{className:"w-8 h-8 text-gray-400"})}),l&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsx(j,{className:"h-6 w-6 animate-spin text-white"})})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(y,{type:"button",variant:"outline",size:"sm",disabled:l,className:"flex items-center space-x-2",onClick:()=>{var r;return(r=document.getElementById("logo-upload"))==null?void 0:r.click()},children:[l?e.jsx(j,{className:"h-4 w-4 animate-spin"}):e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:l?"Upload...":"Changer"})]}),e.jsx("input",{id:"logo-upload",type:"file",accept:"image/*",onChange:N,className:"hidden",disabled:l}),d&&e.jsx(y,{type:"button",variant:"outline",size:"sm",onClick:b,disabled:l,className:"text-red-600 hover:text-red-700",children:"Supprimer"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"JPG, PNG, WebP, SVG â€¢ Max 5MB"})]})]})};export{G as A,P as C,q as L};
